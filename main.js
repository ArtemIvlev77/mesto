(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e){var n=e.baseUrl,r=e.headers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=n,this._headers=r}var n,r;return n=t,(r=[{key:"getInitialCards",value:function(){var e=this;return fetch("".concat(this._url,"/cards"),{method:"GET",headers:this._headers}).then((function(t){return e._addResult(t)}))}},{key:"getUserInfo",value:function(){var e=this;return fetch("".concat(this._url,"/users/me"),{method:"GET",headers:this._headers}).then((function(t){return e._addResult(t)}))}},{key:"editUserInfo",value:function(e){var t=this;return fetch("".concat(this._url,"/users/me/"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.job})}).then((function(e){return t._addResult(e)}))}},{key:"editUserAvatar",value:function(e){var t=this;return fetch("".concat(this._url,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then((function(e){return t._addResult(e)}))}},{key:"addCard",value:function(e,t){var n=this;return fetch("".concat(this._url,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return n._addResult(e)}))}},{key:"setLikes",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"PUT",headers:this._headers}).then((function(e){return t._addResult(e)}))}},{key:"delLikes",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/likes/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._addResult(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._url,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((function(e){return t._addResult(e)}))}},{key:"_addResult",value:function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n,r,o){var i=o.handleCardClick,c=o.handleLikeClick,u=o.handleDeleteClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t.name,this._link=t.link,this._cardId=t._id,this._cardLikes=t.likes,this._ownerId=t.owner._id,this._handleCardClick=i,this._handleLikeClick=c,this._handleDeleteClick=u,this._template=r,this._content=null,this._userId=n}var t,r;return t=e,(r=[{key:"_getTemplate",value:function(){return this._template.content.querySelector(".element").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var e=this;this._removeBtn.addEventListener("click",this._handleDeleteClick),this._likeBtn.addEventListener("click",this._handleLikeClick),this._elementImage.addEventListener("click",(function(){return e._handleCardClick(e._name,e._link)}))}},{key:"render",value:function(){return this._content=this._getTemplate(),this._content.querySelector(".element__title").textContent=this._name,this._elementImage=this._content.querySelector(".element__image"),this._likeBtn=this._content.querySelector(".element__like-btn"),this._removeBtn=this._content.querySelector(".element__remove-btn"),this._ownerId!==this._userId&&this._removeBtn.remove(),this._countLikes=this._content.querySelector(".element__like-count"),this.renderLikes(),this._elementImage.src=this._link,this._elementImage.alt=this._name,this._setEventListeners(),this._content}},{key:"renderLikes",value:function(){this._countLikes.textContent=this._cardLikes.length,this.toggleLikes(this._userId)}},{key:"initSelfLike",value:function(){var e=this;return this._cardLikes.some((function(t){return t._id===e._userId}))}},{key:"setLikes",value:function(e){this._cardLikes=e}},{key:"getCardId",value:function(){return this._cardId}},{key:"toggleLikes",value:function(){this.initSelfLike(this._userId)?this._likeBtn.classList.add("element__like-btn_active"):this._likeBtn.classList.remove("element__like-btn_active")}},{key:"deleteCard",value:function(){this._content.remove()}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){var r=n.settings;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formSelector=t,this.inputSelector=r.inputSelector,this._submitButtonSelector=r.submitButtonSelector,this._inactiveButtonClass=r.inactiveButtonClass,this._inputErrorClass=r.inputErrorClass,this._buttonElement=this._formSelector.querySelector(this._submitButtonSelector)}var t,n;return t=e,(n=[{key:"_showError",value:function(e){this._formSelector.querySelector("#".concat(e.id,"-error")).textContent=e.validationMessage,e.classList.add(this._inputErrorClass)}},{key:"hideError",value:function(e){this._formSelector.querySelector("#".concat(e.id,"-error")).textContent="",e.classList.remove(this._inputErrorClass)}},{key:"_checkInputValidity",value:function(e){e.checkValidity()?this.hideError(e):this._showError(e)}},{key:"disableSubmitBtn",value:function(){this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0}},{key:"toggleButtonState",value:function(){this._formSelector.checkValidity()?(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1):this.disableSubmitBtn(this._buttonElement)}},{key:"_setEventListeners",value:function(){var e=this;Array.from(this._formSelector.querySelectorAll(this.inputSelector)).forEach((function(t){t.addEventListener("input",(function(t){e.toggleButtonState(e._buttonElement),e._checkInputValidity(t.target)}))})),this.toggleButtonState(this._buttonElement)}},{key:"enableValidation",value:function(){this._formSelector.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}}])&&o(t.prototype,n),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=t,this._container=n}var t,n;return t=e,(n=[{key:"addItem",value:function(e){this._container.append(e)}},{key:"prependItem",value:function(e){this._container.prepend(e)}},{key:"renderItems",value:function(e){var t=this;e.forEach((function(e){t._renderer(e)}))}}])&&c(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._popupSelector=document.querySelector(t),this._handleClickOverlay=this._handleClickOverlay.bind(this),this._handleCloseEsc=this._handleCloseEsc.bind(this),this.close=this.close.bind(this),this._popupForm=this._popupSelector.querySelector(".popup__form")}var t,n;return t=e,(n=[{key:"open",value:function(){this._popupSelector.classList.add("popup_is-opened"),document.addEventListener("click",this._handleClickOverlay),document.addEventListener("keydown",this._handleCloseEsc)}},{key:"close",value:function(){this._popupSelector.classList.remove("popup_is-opened"),document.removeEventListener("click",this._handleClickOverlay),document.removeEventListener("keydown",this._handleCloseEsc)}},{key:"_handleCloseEsc",value:function(e){"Escape"===e.key&&this.close()}},{key:"_handleClickOverlay",value:function(e){e.target===this._popupSelector&&this.close()}},{key:"setEventListener",value:function(){this._popupSelector.querySelector(".popup__closeBtn").addEventListener("click",this.close)}}])&&a(t.prototype,n),e}();function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(c,e);var t,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_(r);if(o){var n=_(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return d(this,e)});function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i.call(this,e))._elementImage=t._popupSelector.querySelector(".popup__image-preview"),t._elementImageTitle=t._popupSelector.querySelector(".popup__title_image-preview"),t}return t=c,(n=[{key:"open",value:function(e,t){this._elementImage.src=t,this._elementImage.alt=e,this._elementImageTitle.textContent=e,p(_(c.prototype),"open",this).call(this)}}])&&f(t.prototype,n),c}(l);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(c,e);var t,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(r);if(o){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return S(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,e))._handleFormSubmit=t,n._popupForm=n._popupSelector.querySelector(".popup__form"),n}return t=c,(n=[{key:"_getInputValues",value:function(){var e=this;return this._inputList=this._popupForm.querySelectorAll(".popup__text"),this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setInputValues",value:function(){return this._getInputValues()}},{key:"close",value:function(){this._popupForm.reset(),b(g(c.prototype),"close",this).call(this)}},{key:"setEventListeners",value:function(){var e=this;b(g(c.prototype),"setEventListener",this).call(this),this._popupForm.addEventListener("submit",(function(t){t.preventDefault(),e._handleFormSubmit(e._getInputValues()),e.close()}))}}])&&m(t.prototype,n),c}(l);function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=function(){function e(t){var n=t.nameSelector,r=t.jobSelector,o=t.avatarSelector;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=document.querySelector(n),this._job=document.querySelector(r),this._avatar=document.querySelector(o)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._name.textContent,about:this._job.textContent,avatar:this._avatar.src}}},{key:"setUserInfo",value:function(e){var t=e.name,n=e.about,r=e.avatar;this._name.textContent=t,this._job.textContent=n,this._avatar.src=r}}])&&w(t.prototype,n),e}(),L={nameSelector:".profile__name",jobSelector:".profile__job",avatarSelector:".profile__avatar"},O=(document.querySelector(L.nameSelector),document.querySelector(L.jobSelector),document.querySelector(L.avatarSelector),{formSelector:".popup__form",inputSelector:".popup__text",submitButtonSelector:".popup__save-btn",inactiveButtonClass:"popup__save-btn_invalid",inputErrorClass:"popup__text_invalid"}),I=document.querySelector(".template"),j=document.querySelector(".newElement"),q=j.querySelector(".newElement-form"),P=j.querySelector(".popup__element-title"),R=j.querySelector(".popup__element-link"),B=document.querySelector(".profile__edit-btn"),T=document.querySelector(".profile__add-btn"),D=document.querySelector(".profileEditor").querySelector(".profileEditor-form"),x=document.querySelector(".popup__name-input"),V=document.querySelector(".popup__job-input"),U=document.querySelector(".popupEditAvatar"),A=U.querySelector(".popupAvatarUrl"),F=document.querySelector(".profile__avatar"),H=U.querySelector(".popup__form"),N=document.querySelector(".elements");function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t,n){return(z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Q(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function M(e,t){return(M=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e,t){return!t||"object"!==J(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var W=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&M(e,t)}(c,e);var t,n,r,o,i=(r=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Q(r);if(o){var n=Q(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return K(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=i.call(this,e))._cardDeleteHandler=t,n._popupForm=n._popupSelector.querySelector(".popup__form"),n._saveBtn=n._popupForm.querySelector(".popup__save-btn"),n}return t=c,(n=[{key:"open",value:function(e){this._card=e,z(Q(c.prototype),"open",this).call(this)}},{key:"setEventListeners",value:function(){var e=this;this._popupForm.addEventListener("submit",(function(t){t.preventDefault(),e._cardDeleteHandler(e._card)})),z(Q(c.prototype),"setEventListener",this).call(this)}}])&&G(t.prototype,n),c}(l),X=null,Y=new t({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-20",headers:{authorization:"c991fcc7-9f95-4717-b779-f2f9eb8f4dbe","Content-Type":"application/json"}});Y.getUserInfo().then((function(e){Z.setUserInfo(e),X=e._id})).catch((function(e){console.log(e)}));var Z=new C(L),$=new E(".profileEditor",(function(e){!function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e),Y.editUserInfo($.setInputValues()).then((function(e){Z.setUserInfo(e),$.close()})).catch((function(e){console.log(e)}))}));$.setEventListeners();var ee=new y(".elementPreview");ee.setEventListener(),B.addEventListener("click",(function(){$.open();var e=Z.getUserInfo();x.value=e.name,V.value=e.about,ne.toggleButtonState(),ne.hideError(x),ne.hideError(V)}));var te=new i(q,{settings:O}),ne=new i(D,{settings:O}),re=new i(H,{settings:O});te.enableValidation(),ne.enableValidation(),re.enableValidation(),T.addEventListener("click",(function(){ce.open(),te.disableSubmitBtn(),te.hideError(P),te.hideError(R)}));var oe=function(e){var t=new r(e,X,I,{handleCardClick:function(e,t){ee.open(e,t)},handleLikeClick:function(){(t.initSelfLike()?Y.delLikes(t.getCardId()):Y.setLikes(t.getCardId())).then((function(e){t.setLikes(e.likes),t.renderLikes()})).catch((function(e){console.log(e)}))},handleDeleteClick:function(){ue.open(t)}});return t},ie=new u((function(e){var t=oe(e);ie.addItem(t.render())}),N);Y.getInitialCards().then((function(e){ie.renderItems(e)})).catch((function(e){console.log(e)}));var ce=new E(".newElement",(function(e){Y.addCard(e.name,e.link).then((function(e){var t=oe(e).render();ie.prependItem(t)})).then((function(){ce.close()})).catch((function(e){console.log(e)}))}));ce.setEventListeners();var ue=new W(".popupSubmit",(function(e){Y.deleteCard(e.getCardId()).then((function(){e.deleteCard(),ue.close()})).catch((function(e){console.log(e)}))}));ue.setEventListeners();var ae=new E(".popupEditAvatar",(function(){Y.editUserAvatar(ae.setInputValues()).then((function(e){Z.setUserInfo(e),ae.close()})).catch((function(e){console.log(e)}))}));ae.setEventListeners(),F.addEventListener("click",(function(){re.disableSubmitBtn(),re.hideError(A),ae.open()}))})();